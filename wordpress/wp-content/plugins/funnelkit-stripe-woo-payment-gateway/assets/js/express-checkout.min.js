"use strict";function _get(){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,s){var a=_superPropBase(t,e);if(a)return(a=Object.getOwnPropertyDescriptor(a,e)).get?a.get.call(arguments.length<3?t:s):a.value}).apply(this,arguments)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(s){var a=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(s);return _possibleConstructorReturn(this,a?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){if(e&&("object"===_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var s=0;s<e.length;s++){var a=e[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,s){return e&&_defineProperties(t.prototype,e),s&&_defineProperties(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}!function(c){var e=function(){function t(){if(_classCallCheck(this,t),this.css_selector={},this.button_id="fkwcs_stripe_smart_button",this.payment_request=null,this.express_request_type=null,this.express_button_wrapper=null,this.is_product_page=!1,this.style_value=fkwcs_data.style,this.request_data={},this.cart_request_data={},this.add_to_cart_end_point="fkwcs_add_to_cart",this.is_google_ready_to_pay=!1,this.dataCommon={currency:fkwcs_data.currency,country:fkwcs_data.country_code,requestPayerName:!0,requestPayerEmail:!0,requestPayerPhone:!0},""!==fkwcs_data.pub_key){try{this.stripe=Stripe(fkwcs_data.pub_key,{locale:fkwcs_data.locale}),this.init()}catch(t){"yes"===fkwcs_data.debug_log&&console.log("Stripe Error",t)}this.wcEvents()}}return _createClass(t,[{key:"init",value:function(){"yes"===fkwcs_data.is_product?this.request_data=Object.assign(this.dataCommon,{total:fkwcs_data.single_product.total,requestShipping:"yes"===fkwcs_data.single_product.requestShipping,displayItems:fkwcs_data.single_product.displayItems}):"yes"===fkwcs_data.is_cart&&(this.request_data=Object.assign(this.dataCommon,{total:fkwcs_data.cart_data.order_data.total,requestShipping:"yes"===fkwcs_data.shipping_required,displayItems:fkwcs_data.cart_data.displayItems})),this.setupPaymentRequest()}},{key:"ajaxEndpoint",value:function(t){var e="";return e=fkwcs_data.hasOwnProperty("wc_endpoints")&&fkwcs_data.wc_endpoints.hasOwnProperty(t)?fkwcs_data.wc_endpoints[t]:e}},{key:"setRequestData",value:function(t){t.hasOwnProperty("order_data")&&(this.request_data=Object.assign(this.dataCommon,{total:t.order_data.total,currency:t.order_data.currency,country:t.order_data.country_code,requestShipping:"yes"===t.shipping_required,displayItems:t.order_data.displayItems}))}},{key:"getRequestData",value:function(){return this.request_data}},{key:"setupPaymentRequest",value:function(){var t=this.getRequestData();if(0!==Object.keys(t).length)try{var e=this.stripe.paymentRequest(t);this.productEvents(e),e.canMakePayment().then(this.makePayment.bind(this)).catch(this.makePaymentCatch.bind(this)),e.on("paymentmethod",this.onPaymentMethod.bind(this)),e.on("shippingaddresschange",this.shippingAddressChange.bind(this)),e.on("shippingoptionchange",this.shippingOptionChange.bind(this)),e.on("cancel",this.cancelPayment.bind(this))}catch(t){console.log(t)}}},{key:"productEvents",value:function(s){var a=this,n=(c(".fkwcs_smart_cart_button").off("click").on("click",function(t){s.show(),t.preventDefault()}),c("body").off("click",".fkwcs_smart_checkout_button").on("click",".fkwcs_smart_checkout_button",function(t){s.show(),t.preventDefault()}),c("button.fkwcs_smart_product_button"));n.off("click").on("click",function(t){var e=c("form.cart button.single_add_to_cart_button");if(!c(this).hasClass("fkwcs_disabled_btn"))return s.show(),t.preventDefault(),c.when(a.addToCartProduct());e.is(".wc-variation-is-unavailable")?window.alert(wc_add_to_cart_variation_params.i18n_unavailable_text):e.is(".wc-variation-selection-needed")&&window.alert(wc_add_to_cart_variation_params.i18n_make_a_selection_text)}),c(document.body).off("show_variation").on("show_variation",function(t,e,s){s?n.removeClass("fkwcs_disabled_btn"):n.addClass("fkwcs_disabled_btn")}),c(document.body).off("hide_variation").on("hide_variation",function(){n.addClass("fkwcs_disabled_btn")}),c(document.body).off("woocommerce_variation_has_changed").on("woocommerce_variation_has_changed",function(){a.updateSelectedProductsData(s)}),c("form.cart .quantity").off("input").on("input",".qty",function(){a.updateSelectedProductsData(s)})}},{key:"updateSelectedProductsData",value:function(e){c.when(this.prepareSelectedProductData()).then(function(t){t.error?self.showErrorMessage(t.error):c.when(e.update({total:t.total,displayItems:t.displayItems})).then(function(){})})}},{key:"createButton",value:function(t){}},{key:"makePayment",value:function(t){var e=c(".fkwcs_smart_buttons");if(t){var s=c(".fkwcs_express_checkout_button_icon"),a=c(".fkwcs_stripe_smart_button_wrapper"),n=c("#fkwcs-payment-request-separator"),r="";if(!0!==this.is_google_ready_to_pay||"yes"!==fkwcs_data.google_pay_as_express||!1!==t.applePay&&null!==t.applePay){if(t.applePay)this.express_request_type="apple_pay",this.express_button_wrapper="fkwcs_ec_applepay_button",r="dark"===fkwcs_data.style.theme?fkwcs_data.icons.applepay_light:fkwcs_data.icons.applepay_gray;else if(t.googlePay)this.express_request_type="google_pay",this.express_button_wrapper="fkwcs_ec_googlepay_button",r="dark"===fkwcs_data.style.theme?fkwcs_data.icons.gpay_light:fkwcs_data.icons.gpay_gray;else{if(!this.linkEnabled())return void e.hide();this.express_request_type="payment_request_api",this.express_button_wrapper="fkwcs_ec_link_button",r=fkwcs_data.icons.link}a.hasClass("fkwcs_hide_button")||e.show(),this.makeButtonVisibleInline(),this.buttonOnProductPage(),this.buttonOnCartPage(),this.buttonOnCheckoutPage(),s.hide(),e.addClass("fkwcs_express_"+this.express_request_type),e.removeClass("fkwcs_ec_payment_button-"+fkwcs_data.style.theme),e.addClass(this.express_button_wrapper+"-"+fkwcs_data.style.theme),""!==r&&(s.attr("src",r),s.show()),n.hasClass("cart")&&n.show(),n.hasClass("checkout")&&n.show(),!n.hasClass("fkwcs-product")||a.hasClass("inline")||n.show(),a.length&&(a.css("display","block"),c(document.body).trigger("fkwcs_smart_buttons_showed",["stripe",t])),"inline"===fkwcs_data.style.button_position&&a.hasClass("fkwcs-product")&&(document.getElementById("fkwcs_stripe_smart_button_wrapper").style.display="inline-block")}else t.googlePay=!1,t.link=!1}else"yes"===fkwcs_data.debug_log&&(console.log(fkwcs_data.debug_msg),e.hide()),c(document.body).trigger("fkwcs_smart_buttons_not_available")}},{key:"onPaymentMethod",value:function(e){var s=this,t=this.paymentMethodData(e);c.ajax({type:"POST",data:t,dataType:"text",url:this.ajaxEndpoint("wc_stripe_create_order"),success:function(t){t=function(t){t=t.match(/\{(?:[^{}]|(\{[^{}]*\}))*\}/);if(!t)return console.warn("No JSON object found in response."),null;try{return JSON.parse(t[0])}catch(t){return console.error("Failed to parse JSON:",t),null}}(t);t&&"success"===t.result?!1===s.confirmPaymentIntent(e,t.redirect)&&(window.location=t.redirect):s.abortPayment(e,t?t.messages:"Error processing payment")}})}},{key:"addToCartProduct",value:function(){var t=c(".single_add_to_cart_button").val(),e=c(".single_variation_wrap"),e=(e.length&&(t=e.find('input[name="product_id"]').val()),c(".quantity .qty").val()),a={fkwcs_nonce:fkwcs_data.fkwcs_nonce,action:"add_to_cart",product_id:t,qty:e,attributes:c(".variations_form").length?this.getVariationAttributes().attributes:[]},t=c("form.cart").serializeArray();return c.each(t,function(t,e){var s;/^addon-/.test(e.name)&&(/\[\]$/.test(e.name)?(s=e.name.substring(0,e.name.length-2),a[s]?a[s].push(e.value):a[s]=[e.value]):a[e.name]=e.value)}),c.ajax({type:"POST",data:a,url:this.ajaxEndpoint(this.add_to_cart_end_point),success:function(t){c(document.body).trigger("added_to_cart",[t.fragments,t.cart_hash,c(".single_add_to_cart_button")])}})}},{key:"prepareSelectedProductData",value:function(){var t=c(".single_variation_wrap"),e=c(".single_add_to_cart_button").val(),t=(0<t.length&&(e=c(".single_variation_wrap").find('input[name="product_id"]').val()),c("#product-addons-total")),s=0,t=(0<t.length&&(s=(t.data("price_data")||[]).reduce(function(t,e){return t+e.cost},0)),{fkwcs_nonce:fkwcs_data.fkwcs_nonce,product_id:e,qty:c(".quantity .qty").val(),addon_value:s,attributes:c(".variations_form").length?this.getVariationAttributes().attributes:[]});return c.ajax({type:"POST",data:t,url:this.ajaxEndpoint("fkwcs_selected_product_data")})}},{key:"logError",value:function(t){c.ajax({type:"POST",url:fkwcs_data.admin_ajax,data:{action:"fkwcs_js_errors",_security:fkwcs_data.js_nonce,failed:2<arguments.length&&void 0!==arguments[2]&&arguments[2],error:t}})}},{key:"getVariationAttributes",value:function(){var t=c(".variations_form").find(".variations select"),e={},s=0;return t.each(function(){var t=c(this).data("attribute_name")||c(this).attr("name");e[t]=c(this).val()||"",s++}),{count:s,chosenCount:0,attributes:e}}},{key:"paymentMethodData",value:function(t){var e=t.paymentMethod,s=e.billing_details,a=s.email,n=s.phone,r=s.address,s=s.name,o=t.shippingAddress,i={fkwcs_nonce:fkwcs_data.fkwcs_nonce,billing_first_name:null!==s?s.split(" ").slice(0,1).join(" "):"test",billing_last_name:null!==s?s.split(" ").slice(1).join(" "):"test",billing_company:"",billing_email:null!==a?a:t.payerEmail,billing_phone:null!==n?n:t.payerPhone&&t.payerPhone.replace("/[() -]/g",""),order_comments:"",payment_method:"fkwcs_stripe",terms:1,fkwcs_source:e.id,payment_request_type:this.express_request_type};return 0<c('input[name="billing_email"]').length&&""!==c('input[name="billing_email"]').val()&&(i.billing_email=c('input[name="billing_email"]').val()),"apple_pay"===this.express_request_type&&0<c("li.payment_method_fkwcs_stripe_apple_pay").length&&(i.payment_method="fkwcs_stripe_apple_pay"),i=this.prepareBillingAddress(i,r),i=this.prepareShippingAddress(i,o),"yes"===fkwcs_data.is_checkout?(null!==t.shippingOption&&c('input[name="shipping_method[0]"][value="'+t.shippingOption.id+'"]').prop("checked",!0),s=c("form[name=checkout]").serializeArray(),c.each(s,function(t,e){!1!==Object.prototype.hasOwnProperty.call(i,e.name)&&""!==i[e.name]||(i[e.name]=e.value)}),i.page_from="checkout"):"yes"===fkwcs_data.is_product?i.page_from="product":i.page_from="cart",!0===Object.prototype.hasOwnProperty.call(i,"wc-fkwcs_stripe-payment-token")&&delete i["wc-fkwcs_stripe-payment-token"],i=JSON.parse(JSON.stringify(i))}},{key:"prepareBillingAddress",value:function(t,e){return null!==e&&(t.billing_address_1=null!==e?e.line1:"",t.billing_address_2=null!==e?e.line2:"",t.billing_city=null!==e?e.city:"",t.billing_state=null!==e?e.state:"",t.billing_postcode=null!==e?e.postal_code:"",t.billing_country=null!==e?e.country:""),t}},{key:"prepareShippingAddress",value:function(t,e){return e&&(t.shipping_first_name=e.recipient.split(" ").slice(0,1).join(" "),t.shipping_last_name=e.recipient.split(" ").slice(1).join(" "),t.shipping_company=e.organization,t.shipping_country=e.country,t.shipping_address_1=void 0===e.addressLine[0]?"":e.addressLine[0],t.shipping_address_2=void 0===e.addressLine[1]?"":e.addressLine[1],t.shipping_city=e.city,t.shipping_state=e.region,t.hasOwnProperty("billing_phone")&&(t.shipping_phone=t.billing_phone),t.shipping_postcode=e.postalCode,t.ship_to_different_address=1),t}},{key:"confirmPaymentIntent",value:function(t,e){var s=e.match(/^#?fkwcs-confirm-(pi|si)-([^:]+):(.+):(.+):(.+):(.+)$/);if(!s||s.length<5)return window.location.redirect=e,!1;var e=s[1],a=s[2],s=decodeURIComponent(s[3]);this.confirmPayment(t,a,s,e)}},{key:"confirmPayment",value:function(s,a,n,r){var o=this,t=null,t="si"===r?this.stripe.handleCardSetup(a,{payment_method:s.paymentMethod.id},{handleActions:!1}):this.stripe.confirmCardPayment(a,{payment_method:s.paymentMethod.id},{handleActions:!1}),i=c("form.woocommerce-checkout");t.then(function(t){var e;t.error?(o.logError(t.error),c(".woocommerce-error").remove(),i.unblock(),c(".woocommerce-notices-wrapper:first-child").html('<div class="woocommerce-error fkwcs-errors">'+t.error.message+"</div>").show(),s.complete("fail")):(s.complete("success"),"requires_action"===(t=t["si"===r?"setupIntent":"paymentIntent"]).status||"requires_source_action"===t.status?(e=o,("si"===r?o.stripe.handleCardSetup(a):o.stripe.confirmCardPayment(a)).then(function(t){t.error?(e.logError(t.error),c(".woocommerce-error").remove(),i.unblock(),c(".woocommerce-notices-wrapper:first-child").html('<div class="woocommerce-error fkwcs-errors">'+t.error.message+"</div>").show()):(i.addClass("processing"),i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),window.location=n)})):(i.addClass("processing"),i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),window.location=n))})}},{key:"abortPayment",value:function(t,e){t.complete("success"),this.showErrorMessage(e)}},{key:"shippingAddressChange",value:function(e){var t=e.shippingAddress,t={fkwcs_nonce:fkwcs_data.fkwcs_nonce,country:t.country,state:t.region,postcode:t.postalCode,city:t.city,address:void 0===t.addressLine[0]?"":t.addressLine[0],address_2:void 0===t.addressLine[1]?"":t.addressLine[1],payment_request_type:this.express_request_type,is_product_page:this.is_product_page};return c.ajax({type:"POST",data:t,url:this.ajaxEndpoint("fkwcs_update_shipping_address"),success:function(t){"success"===t.result?e.updateWith({status:t.result,total:t.total,shippingOptions:t.shipping_methods,displayItems:t.displayItems}):"fail"===t.result&&e.updateWith({status:"fail"})}})}},{key:"shippingOptionChange",value:function(e){var t=e.shippingOption,t={fkwcs_nonce:fkwcs_data.fkwcs_nonce,shipping_method:[t.id],payment_request_type:this.express_request_type,is_product_page:this.is_product_page};return c.ajax({type:"POST",data:t,url:this.ajaxEndpoint("fkwcs_update_shipping_option"),success:function(t){"success"===t.result&&e.updateWith({status:"success",total:t.total,displayItems:t.displayItems}),"fail"===t.result&&e.updateWith({status:"fail"})}})}},{key:"makePaymentCatch",value:function(t){console.log("error",t)}},{key:"cancelPayment",value:function(){c(document.body).trigger("fkwcs_express_cancel_payment",this)}},{key:"showErrorMessage",value:function(t){c(".woocommerce-error").remove(),("no"!==fkwcs_data.is_product?c(".product").first():c("form.checkout").closest("form")).before(t),window.scrollTo({top:100,behavior:"smooth"})}},{key:"getCartDetails",value:function(){var t={fkwcs_nonce:fkwcs_data.fkwcs_nonce},e=this;c.ajax({type:"POST",data:t,url:this.ajaxEndpoint("fkwcs_get_cart_details"),success:function(t){t.success&&(e.setRequestData(t.data),e.setupPaymentRequest())}})}},{key:"wcEvents",value:function(){var a=this,s=this;c(document.body).on("updated_checkout",function(t,e){try{e&&e.fragments&&(s.setRequestData(e.fragments.fkwcs_cart_details),s.setupPaymentRequest(),!1===e.fragments.fkwcs_cart_details.is_fkwcs_need_payment?document.getElementById("fkwcs_stripe_smart_button_wrapper").classList.add("fkwcs_hide_button"):document.getElementById("fkwcs_stripe_smart_button_wrapper").classList.remove("fkwcs_hide_button"))}catch(t){}}),c(document.body).on("updated_cart_totals",function(){s.getCartDetails()}),c(document.body).on("wc_fragments_refreshed added_to_cart removed_from_cart wc_fragments_loaded",function(t,e){setTimeout(function(){if("undefined"==typeof wc_cart_fragments_params)return!1;var t;"undefined"!=typeof Storage&&(t=sessionStorage.getItem(wc_cart_fragments_params.fragment_name),"object"===_typeof(t=JSON.parse(t)))&&(a.cart_request_data=t.fkwcs_cart_details,"yes"!==fkwcs_data.is_product)&&(s.setRequestData(t.fkwcs_cart_details),s.setupPaymentRequest())},300)}),c(document.body).on("fkwcs_express_button_init",function(){var t=c("#fkcart-modal");"yes"===fkwcs_data.is_product&&!t.hasClass("fkcart-show")||(0<Object.keys(a.cart_request_data).length&&a.setRequestData(a.cart_request_data),a.setupPaymentRequest())}),c(document.body).on("fkwcs_express_button_update_cart_details",function(t,e){e.hasOwnProperty("fkwcs_cart_details")&&(a.setRequestData(e.fkwcs_cart_details),a.setupPaymentRequest())}),c(document.body).on("fkcart_fragments_refreshed",function(t,e){var s=c("#fkcart-modal");void 0!==e&&e.hasOwnProperty("fkwcs_cart_details")&&(a.cart_request_data=e.fkwcs_cart_details,s.hasClass("fkcart-show"))&&(a.setRequestData(a.cart_request_data),a.setupPaymentRequest())}),c(document.body).on("fkwcs_google_ready_pay",function(){s.is_google_ready_to_pay=!0}),c(document.body).on("fkcart_cart_closed",function(){var t;"yes"===fkwcs_data.is_product&&((t=c("form.cart").find(".qty")).length&&t.val(1),a.request_data=Object.assign(a.dataCommon,{total:fkwcs_data.single_product.total,requestShipping:"yes"===fkwcs_data.single_product.requestShipping,displayItems:fkwcs_data.single_product.displayItems}),a.setupPaymentRequest())})}},{key:"setCss",value:function(t,e,s){this.css_selector.hasOwnProperty(t)||(this.css_selector[t]={}),this.css_selector[t][e]=s}},{key:"applyCss",value:function(){for(var t in this.css_selector)if(0!==Object.keys(this.css_selector[t]).length)for(var e in this.css_selector[t])c(t).css(e,this.css_selector[t][e])}},{key:"buttonOnProductPage",value:function(){var t,e,s,a,n;1==fkwcs_data.is_product_page&&0!==c("form.cart button.single_add_to_cart_button").length&&(t=c("form.cart button.single_add_to_cart_button:visible"),e=c(".fkwcs_smart_buttons"),s=10<this.style_value.button_length?"min-width":"width",!(a="px")!==e.hasClass("fkwcs_smart_product_button"))&&("above"===this.style_value.button_position?(this.setCss("#fkwcs_stripe_smart_button_wrapper","width","100%"),this.setCss("#fkwcs-payment-request-separator","width","200px"),this.setCss("form.cart button.single_add_to_cart_button",s,"200px"),this.setCss("form.cart button.single_add_to_cart_button","float","left"),this.setCss("form.cart","display","inline-block"),this.setCss(".fkwcs_smart_buttons",s,"200px")):(n=t.outerWidth(),0<c("form.cart .quantity").length&&(n=n+c("form.cart .quantity").width()+parseInt(c("form.cart .quantity").css("marginRight").replace("px",""))),"inline"===this.style_value.button_position?(n=(n=t.outerWidth())<120?150:n,c("form.cart").width()<500&&this.makeButtonVisibleInline(),this.setCss("form.cart button.single_add_to_cart_button",s,n+"px")):(this.setCss("form.grouped_form button.single_add_to_cart_button",s,n+"px"),0<c(".theme-kadence button.single_add_to_cart_button").length&&(this.setCss(".theme-kadence button.single_add_to_cart_button",s,(n=100)+(a="%")),this.setCss(".theme-kadence button.single_add_to_cart_button","margin-top","20px"))),this.setCss("#fkwcs_stripe_smart_button_wrapper",s,n+a),this.setCss("form.cart .fkwcs_smart_buttons",s,n+a),"below"===this.style_value.button_position&&(this.setCss(".theme-twentytwentytwo .fkwcs_smart_buttons",s,t.outerWidth()+"px"),this.setCss(".theme-twentytwentytwo #fkwcs-payment-request-separator",s,t.outerWidth()+"px"))),this.applyCss(),this.expressBtnStyle(e,t))}},{key:"buttonOnCartPage",value:function(){var t,e;"yes"===fkwcs_data.is_cart&&0!==c(".wc-proceed-to-checkout .checkout-button").length&&(t=c(".wc-proceed-to-checkout .checkout-button"),e=c(".fkwcs_smart_buttons"),30<c(".place-order #place_order").outerHeight()&&this.setCss(".fkwcs_smart_buttons","height",t.outerHeight()+"px"),this.setCss(".fkwcs_smart_buttons","font-size",t.css("font-size")),this.applyCss(),this.expressBtnStyle(e,t))}},{key:"buttonOnCheckoutPage",value:function(){var t=c(".woocommerce-billing-fields");"yes"===fkwcs_data.is_checkout&&0!==t.length&&(this.setCss("#fkwcs_stripe_smart_button_wrapper","max-width",t.outerWidth(!0)),this.applyCss())}},{key:"expressBtnStyle",value:function(s,a){c.each(["padding","border-radius","box-shadow","font-weight","text-shadow","font-size","line-height","padding"],function(t,e){s.css(e,a.css(e))}),s.css("max-height",a.outerHeight()+"px")}},{key:"makeButtonVisibleInline",value:function(){var t,e,s="",a=c("#fkwcs_stripe_smart_button_wrapper");0!==a.length&&(a.hasClass("inline")&&(t=(a=a.parent()).children(".single_add_to_cart_button"),e=a.children(".quantity"),s=a.outerWidth()-((a=t.outerWidth())+e.outerWidth()+10),this.setCss("#fkwcs_stripe_smart_button_wrapper .single_add_to_cart_button","marginRight",e.css("marginRight")),a<s?(this.setCss("#fkwcs_stripe_smart_button_wrapper .single_add_to_cart_button","margin",0),this.setCss("#fkwcs_stripe_smart_button_wrapper .single_add_to_cart_button","marginRight",e.css("marginRight")),this.setCss("#fkwcs_stripe_smart_button_wrapper .single_add_to_cart_button","clear","unset"),this.setCss("#fkwcs_stripe_smart_button_wrapper","margin","0px"),this.setCss("#fkwcs_stripe_smart_button_wrapper","display","inline-block")):(this.setCss("#fkwcs_stripe_smart_button_wrapper .single_add_to_cart_button","margin","10px 0"),this.setCss("#fkwcs_stripe_smart_button_wrapper .single_add_to_cart_button","flex","initial"),this.setCss("#fkwcs_stripe_smart_button_wrapper .single_add_to_cart_button","clear","both"),this.setCss("#fkwcs_stripe_smart_button_wrapper .theme-flatsome .cart .quantity","width","100%"),this.setCss("#fkwcs_stripe_smart_button_wrapper .theme-flatsome .cart .quantity","clear","both"),this.setCss("#fkwcs_stripe_smart_button_wrapper","maringTop","10px"),this.setCss("#fkwcs_stripe_smart_button_wrapper","display","block")),60<(s=t.outerHeight())&&this.setCss("#fkwcs_stripe_smart_button_wrapper .single_add_to_cart_button","height","60"),s<35&&this.setCss("#fkwcs_stripe_smart_button_wrapper .single_add_to_cart_button","height","35"),c("#fkwcs_stripe_smart_button_wrapper").width(a)),this.applyCss())}},{key:"linkEnabled",value:function(){return"yes"===fkwcs_data.link_button_enabled&&"yes"===fkwcs_data.express_pay_enabled}}]),t}(),t=function(){_inherits(s,e);var t=_createSuper(s);function s(){return _classCallCheck(this,s),t.call(this)}return _createClass(s,[{key:"init",value:function(){fkwcs_data.hasOwnProperty("google_pay_as_express")&&"yes"===fkwcs_data.google_pay_as_express&&(this.google_pay_client=null,this.shipping_options=[],this.request_data={},this.google_is_ready=null,this.add_to_cart_end_point="fkwcs_gpay_add_to_cart",this.gateway_id="fkwcs_stripe_google_pay",this.createPaymentClient())}},{key:"googlePayVersion",value:function(){return{apiVersion:2,apiVersionMinor:0}}},{key:"getBaseCardBrand",value:function(){return{type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY"],allowedCardNetworks:["AMEX","DISCOVER","INTERAC","JCB","MASTERCARD","VISA"],assuranceDetailsRequired:!0},tokenizationSpecification:{type:"PAYMENT_GATEWAY",parameters:{gateway:"stripe","stripe:version":"2018-10-31","stripe:publishableKey":fkwcs_data.pub_key}}}}},{key:"getMerchantData",value:function(){var t={environment:"test"===fkwcs_data.mode?"TEST":"PRODUCTION",merchantId:fkwcs_data.google_pay.merchant_id,merchantName:fkwcs_data.google_pay.merchant_name,paymentDataCallbacks:{onPaymentAuthorized:function(){return new Promise(function(t){t({transactionState:"SUCCESS"})}.bind(this))}}};return"test"===fkwcs_data.mode&&delete t.merchantId,this.shippingAddressRequired()&&(t.paymentDataCallbacks.onPaymentDataChanged=this.paymentDataChanged.bind(this)),t}},{key:"createGooglePayButton",value:function(t){return c("<div class='fkwcs_google_pay_wrapper fkwcs_smart_product_button ".concat(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"","'></div>")).html(this.google_pay_client.createButton(t))}},{key:"createPaymentClient",value:function(){var t=this;try{this.google_pay_client=new google.payments.api.PaymentsClient(this.getMerchantData());var e=this.googlePayVersion();e.allowedPaymentMethods=[this.getBaseCardBrand()],this.google_pay_client.isReadyToPay(e).then(function(){t.google_is_ready=!0,c(document.body).trigger("fkwcs_google_ready_pay",[t.google_pay_client]),t.createCheckoutExpressBtn()}).catch(function(t){console.log("error",t)})}catch(t){console.log(t)}}},{key:"buttonOnProductPage",value:function(){var t,e,s,a,n,r=this;1==fkwcs_data.is_product_page&&0!==c("form.cart button.single_add_to_cart_button").length&&(t=c("form.cart button.single_add_to_cart_button:visible"),e=c(".fkwcs_smart_buttons"),s=10<this.style_value.button_length?"min-width":"width",!(a="px")!==e.hasClass("fkwcs_smart_product_button"))&&("above"===this.style_value.button_position?(this.setCss("#fkwcs_stripe_smart_button_wrapper","width","100%"),this.setCss("#fkwcs-payment-request-separator","width","200px"),this.setCss("form.cart button.single_add_to_cart_button",s,"200px"),this.setCss("form.cart button.single_add_to_cart_button","float","left"),this.setCss("form.cart","display","inline-block"),this.setCss(".fkwcs_smart_buttons",s,"200px")):(n=t.outerWidth(),0<c("form.cart .quantity").length&&(n=n+c("form.cart .quantity").width()+parseInt(c("form.cart .quantity").css("marginRight").replace("px",""))),"inline"===this.style_value.button_position?(n=(n=t.outerWidth())<120?150:n,c("form.cart").width()<500&&this.makeButtonVisibleInline(),this.setCss("form.cart button.single_add_to_cart_button",s,n+"px"),this.setCss("#fkwcs_stripe_smart_button_wrapper.fkwcs-product","display","inline-block")):(this.setCss("form.grouped_form button.single_add_to_cart_button",s,n+"px"),0<c(".theme-kadence button.single_add_to_cart_button").length&&(this.setCss(".theme-kadence button.single_add_to_cart_button",s,(n=100)+(a="%")),this.setCss(".theme-kadence button.single_add_to_cart_button","margin-top","20px"))),this.setCss("#fkwcs_stripe_smart_button_wrapper",s,n+a),this.setCss("form.cart .fkwcs_smart_buttons",s,n+a),setTimeout(function(t){r.setCss("#fkwcs_stripe_smart_button_wrapper .gpay-card-info-container",s,t+"px"),r.setCss("#fkwcs_stripe_smart_button_wrapper .gpay-card-info-container","min-width",t+"px"),r.setCss("#fkwcs_stripe_smart_button_wrapper .gpay-card-info-iframe","width",t+"px"),r.applyCss()},300,n),"below"===this.style_value.button_position&&(this.setCss(".theme-twentytwentytwo .fkwcs_smart_buttons",s,t.outerWidth()+"px"),this.setCss(".theme-twentytwentytwo #fkwcs-payment-request-separator",s,t.outerWidth()+"px"))),this.applyCss(),this.expressBtnStyle(e,t))}},{key:"createCheckoutExpressBtn",value:function(){var t,a=this,e=(c("#fkwcs_stripe_smart_button_wrapper").css("display","block"),c("#fkwcs_custom_express_button"));0<e.length&&("1"===fkwcs_data.is_product_page||"yes"===fkwcs_data.is_product_page?(e.after(this.createGooglePayButton(this.getSingleProductExpressOptions(),"fkwcs-single-product")),this.buttonOnProductPage(),t=c("form.cart .fkwcs_google_pay_wrapper"),c(document.body).off("show_variation").on("show_variation",function(){t.removeClass("fkwcs_disabled_btn")}),c(document.body).off("hide_variation").on("hide_variation",function(){t.addClass("fkwcs_disabled_btn")})):"1"!==fkwcs_data.is_cart&&"yes"!==fkwcs_data.is_cart||(e.after(this.createGooglePayButton(this.getCartExpressOptions(),"fkwcs-woocommerce-cart")),c(document.body).on("wc_fragments_refreshed",function(t,e){setTimeout(function(){var t;"sessionStorage"in window&&null!==window.sessionStorage&&null!=(t=sessionStorage.getItem(wc_cart_fragments_params.fragment_name))&&"object"===_typeof(t=JSON.parse(t))&&t.hasOwnProperty("fkwcs_google_pay_data")&&(fkwcs_data.gpay_cart_data=t.fkwcs_google_pay_data,c("#fkwcs_stripe_smart_button_wrapper").css("display","block"),c(".fkwcs-woocommerce-cart").remove(),c("#fkwcs_custom_express_button").after(a.createGooglePayButton(a.getCartExpressOptions(),"fkwcs-woocommerce-cart")))},1e3)}))),c(document.body).on("added_to_cart fkcart_fragments_refreshed",function(t,e){void 0!==e&&e.hasOwnProperty("fkwcs_google_pay_data")&&(fkwcs_data.gpay_cart_data=e.fkwcs_google_pay_data)}),c(document.body).on("fkwcs_generate_fkcart_mini_button",function(){c(".fkwcs_fkcart_gpay_wrapper").html(a.createGooglePayButton(a.getCartExpressOptions(),"mini-cart"));for(var t=c("#fkcart-modal .fkcart-checkout-wrap #fkcart-checkout-button"),e=["font-size","font-weight","border-radius","line-height"],s=0;s<e.length;s++)c(".fkcart-checkout-wrap.fkcart-panel.fkwcs_fkcart_gpay_wrapper button").css(e[s],t.css(e[s]))})}},{key:"getSingleProductExpressOptions",value:function(){return{buttonColor:fkwcs_data.google_pay_btn_color,buttonType:fkwcs_data.google_pay_btn_theme,buttonSizeMode:"fill",onClick:this.startSingleProductCheckout.bind(this)}}},{key:"getCartExpressOptions",value:function(){return{buttonColor:fkwcs_data.google_pay_btn_color,buttonType:fkwcs_data.google_pay_btn_theme,buttonSizeMode:"fill",onClick:this.startExpressCartGpayPayment.bind(this)}}},{key:"startExpressCartGpayPayment",value:function(){var t=fkwcs_data.gpay_cart_data||fkwcs_data.gpay_single_product;t&&this.update_transaction_data(t),this.startSingleProductGpayPayment()}},{key:"startSingleProductCheckout",value:function(){var e=this;try{c.when(this.addToCartProduct()).then(function(t){e.update_transaction_data(null==t||null==(t=t.fragments)?void 0:t.fkwcs_google_pay_data),e.startSingleProductGpayPayment()})}catch(t){}}},{key:"startSingleProductGpayPayment",value:function(){var e=this;this.google_pay_client.loadPaymentData(this.buildGpayPaymentData()).then(this.productSingleProductGpayData.bind(this)).catch(function(t){console.log("error",t),"CANCELED"!==t.statusCode&&(t.statusMessage&&-1<t.statusMessage.indexOf("paymentDataRequest.callbackIntent")?e.showError({message:"DEVELOPER_ERROR_WHITELIST"}):e.showError({message:t.statusMessage}))})}},{key:"buildGpayPaymentData",value:function(){var t=c.extend({},this.googlePayVersion(),{emailRequired:!0,environment:"test"===fkwcs_data.mode?"TEST":"PRODUCTION",merchantInfo:{merchantName:fkwcs_data.google_pay.merchant_name,merchantId:fkwcs_data.google_pay.merchant_id},allowedPaymentMethods:[this.getBaseCardBrand()]});return t.shippingAddressRequired=this.shippingAddressRequired(),t.callbackIntents=["PAYMENT_AUTHORIZATION"],t.allowedPaymentMethods[0].parameters.billingAddressRequired=!0,t.allowedPaymentMethods[0].parameters.billingAddressRequired&&(t.allowedPaymentMethods[0].parameters.billingAddressParameters={format:"FULL",phoneNumberRequired:!0}),(t=c.extend(t,this.request_data)).shippingAddressRequired&&(t.shippingAddressParameters={},t.shippingOptionRequired=!0,t.shippingOptionParameters={shippingOptions:this.shipping_options},t.callbackIntents=["SHIPPING_ADDRESS","SHIPPING_OPTION","PAYMENT_AUTHORIZATION"]),t}},{key:"paymentDataChanged",value:function(t){var s=this;return new Promise(function(e){s.update_payment_data(t).then(function(t){"fail"===t.result?e({error:{reason:"SHIPPING_ADDRESS_UNSUPPORTED",message:fkwcs_data.shipping_error,intent:"SHIPPING_ADDRESS"}}):e(t.paymentRequestUpdate)}).catch(function(t){e({error:{reason:"SHIPPING_ADDRESS_UNSUPPORTED",message:fkwcs_data.shipping_error,intent:"SHIPPING_ADDRESS"}})})})}},{key:"update_transaction_data",value:function(t){var e=t.order_data.displayItems;this.request_data={transactionInfo:{countryCode:t.order_data.country_code.toUpperCase(),currencyCode:t.order_data.currency.toUpperCase(),totalPriceStatus:"ESTIMATED",totalPrice:t.order_data.total.amount.toString(),displayItems:e,totalPriceLabel:t.order_data.total.label}},null!=t&&t.shipping_options&&(this.shipping_options=null==t?void 0:t.shipping_options)}},{key:"mapAddress",value:function(t,e){var s={};return e.hasOwnProperty("address1")&&(s.line_1=null==e?void 0:e.address1),e.hasOwnProperty("address2")&&(s.line_2=(null==e?void 0:e.address2)+(null==e?void 0:e.address3)),e.hasOwnProperty("locality")&&(s.city=null==e?void 0:e.locality),e.hasOwnProperty("postalCode")&&(s.postal_code=null==e?void 0:e.postalCode),e.hasOwnProperty("administrativeArea")&&(s.state=null==e?void 0:e.administrativeArea),e.hasOwnProperty("countryCode")&&(s.country=null==e?void 0:e.countryCode),e.hasOwnProperty("name")&&(s.name=e.name),s}},{key:"updateAddress",value:function(t){var e={},s=t.hasOwnProperty("shippingAddress")?t.shippingAddress:null,a=(null!==s&&(e.shipping=this.mapAddress("shipping",s),e.shipping.shipping_method=null==t?void 0:t.shippingOptionData),t.hasOwnProperty("paymentMethodData")&&t.paymentMethodData.hasOwnProperty("info")&&t.paymentMethodData.info.hasOwnProperty("billingAddress")?t.paymentMethodData.info.billingAddress:null);return null!==a&&(e.billing=this.mapAddress("billing",a)),null==a&&null!==s&&(e.billing=this.mapAddress("billing",s)),null!==a&&a.hasOwnProperty("phoneNumber")&&(e.phone=null==a?void 0:a.phoneNumber),null!=t&&t.email&&(e.email=null==t?void 0:t.email),null!=t&&t.phone&&(e.phone=null==t?void 0:t.phone),e}},{key:"map_google_pay_address",value:function(t){return{country:t.countryCode,postcode:t.postalCode,city:t.locality,state:t.administrativeArea}}},{key:"update_payment_data",value:function(s,a){var n=this;return new Promise(function(e){var t="default"===s.shippingOptionData.id?null:s.shippingOptionData.id;c.ajax({url:fkwcs_data.wc_endpoints.fkwcs_gpay_update_shipping_address,dataType:"json",method:"POST",data:c.extend({fkwcs_nonce:fkwcs_data.fkwcs_nonce},{shipping_address:n.map_google_pay_address(s.shippingAddress),shipping_method:[t]},a),success:function(t){e(t)}})})}},{key:"productSingleProductGpayData",value:function(t){var s=this,e=JSON.parse(t.paymentMethodData.tokenizationData.token),a=this.updateAddress(t),t={name:a.billing.name,email:a.email,phone:null==a?void 0:a.phone,address:{country:null==(t=a.billing)?void 0:t.country,city:null==(t=a.billing)?void 0:t.city,postal_code:null==(t=a.billing)?void 0:t.postal_code,state:null==(t=a.billing)?void 0:t.state,line1:null==(t=a.billing)?void 0:t.line1,line2:null==(t=a.billing)?void 0:t.line2}};c("body").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),this.stripe.createPaymentMethod({type:"card",card:{token:e.id},billing_details:t}).then(function(e){if(e.error)return s.showError(e.error);a.paymentMethod=e.paymentMethod.id,c.ajax({type:"POST",data:s.prepareCheckoutData(a),dataType:"text",url:s.ajaxEndpoint("fkwcs_gpay_button_payment_request"),success:function(t){t=function(t){t=t.match(/\{(?:[^{}]|(\{[^{}]*\}))*\}/);if(!t)return console.warn("No JSON object found in response."),null;try{return JSON.parse(t[0])}catch(t){return console.error("Failed to parse JSON:",t),null}}(t);t&&"success"===t.result?!1===s.confirmPaymentIntent(e,t.redirect)&&(window.location=t.redirect):(c("body").unblock(),window.location.reload())}})}).catch(function(){c("body").unblock()})}},{key:"prepareCheckoutData",value:function(t){var e=t.paymentMethod,s=t.email,a=null==t?void 0:t.phone,n=t.billing,r=t.billing.name,t=t.shipping,r={fkwcs_nonce:fkwcs_data.fkwcs_nonce,billing_first_name:null!==r?r.split(" ").slice(0,1).join(" "):"test",billing_last_name:null!==r?r.split(" ").slice(1).join(" "):"test",billing_company:"",billing_email:0<c('input[name="billing_email"]').length&&""!==c('input[name="billing_email"]').val()?c('input[name="billing_email"]').val():s,billing_phone:a?a.replace("/[() -]/g",""):"",order_comments:"",payment_method:this.gateway_id,terms:1,fkwcs_source:e,payment_request_type:this.gateway_id},r=this.prepareBillingAddress(r,n);return r=this.prepareShippingAddress(r,t),"yes"===fkwcs_data.is_product?r.page_from="product":r.page_from="cart",r=JSON.parse(JSON.stringify(r))}},{key:"shippingAddressRequired",value:function(){return"yes"===fkwcs_data.shipping_required}},{key:"prepareBillingAddress",value:function(t,e){return console.trace(),(t=_get(_getPrototypeOf(s.prototype),"prepareBillingAddress",this).call(this,t,e)).billing_address_1=null!==e?e.line_1:"",t.billing_address_2=null!==e?e.line_2:"",t}},{key:"prepareShippingAddress",value:function(t,e){return e&&(t.shipping_first_name=e.name.split(" ").slice(0,1).join(" "),t.shipping_last_name=e.name.split(" ").slice(1).join(" "),t.shipping_country=e.country,t.shipping_address_1=e.line_1,t.shipping_address_2=e.line_2,t.shipping_city=e.city,t.shipping_state=e.state,e.hasOwnProperty("shipping_method")&&(t.shipping_method=Object.values(e.shipping_method)),t.hasOwnProperty("billing_phone")&&(t.shipping_phone=t.billing_phone),t.shipping_postcode=e.postal_code,t.ship_to_different_address=1),t}},{key:"confirmPaymentIntent",value:function(t,e){var s=e.match(/^#?fkwcs-confirm-(pi|si)-([^:]+):(.+):(.+):(.+):(.+)$/);if(!s||s.length<5)return window.location.redirect=e,c("body").unblock(),!1;var e=s[1],a=s[2],s=decodeURIComponent(s[3]);this.confirmPayment(t,a,s,e)}},{key:"confirmPayment",value:function(t,e,s,a){var n=this;("si"==a?this.stripe.handleCardSetup(e,{payment_method:t.paymentMethod.id},{handleActions:!1}):this.stripe.confirmCardPayment(e,{payment_method:t.paymentMethod.id},{handleActions:!1})).then(function(t){t.error?(n.logError(t.error),c("body").unblock()):"requires_action"===(t=t["si"===a?"setupIntent":"paymentIntent"]).status||"requires_source_action"===t.status?("si"==a?n.stripe.handleCardSetup(e):n.stripe.confirmCardPayment(e)).then(function(t){t.error?(n.logError(t.error),c("body").unblock()):window.location=s}):(c("body").unblock(),window.location=s)})}},{key:"setupPaymentRequest",value:function(){}},{key:"setRequestData",value:function(){}}]),s}();new e;try{void 0===fkwcs_data.google_pay||"live"===fkwcs_data.mode&&""===fkwcs_data.google_pay.merchant_id||new t}catch(t){console.log("Error Captured During Gpay initialization",t)}}(jQuery);