"use strict";function ownKeys(e,n){var t,i=Object.keys(e);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(e),n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,t)),i}function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(t),!0).forEach(function(n){_defineProperty(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function _defineProperty(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var wffnFunnel={isSetUpCached:function(){if(void 0!==window.wffnPublicVars.current_step&&"wc_checkout"===window.wffnPublicVars.current_step.type)return!1;var n=(new Date).getTime()/1e3;return 20<parseInt(n-parseInt(window.wffnPublicVars.setup_time))},setUpFunnel:function(){this.init()},init:function(){var i=this;if(this.isSetUpCached()){console.log("cached setup found");try{var n={events:"undefined"!=typeof wffnEvents?wffnEvents:[]};this.SendData("wffn_maybe_setup_funnel",_objectSpread(_objectSpread({},window.wffnfunnelEnvironment),{},{track_data:n,hash:window.wffnPublicVars.hash}),function(n){var e,t;n&&n.hash&&(Cookies.set("wffn_si",n.hash,{path:"/"}),e=n.hash,t=n.current_step.id,window.wffnPublicVars.hash=e,i.HandleAnalytics(e,t,"onload","",n.track_views)),n&&n.next_link&&(window.wffnPublicVars.next_link=n.next_link)})}catch(n){console.log(n)}}else"undefined"!=typeof Cookies&&(void 0!==Cookies.get("wffn_si")&&void 0!==window.wffnfunnelEnvironment&&Object.hasOwnProperty.call(window.wffnfunnelEnvironment,"post_type")&&-1!==["wffn_ty","wffn_oty"].indexOf(window.wffnfunnelEnvironment.post_type)?this.HandleAnalytics(Cookies.get("wffn_si"),window.wffnfunnelEnvironment.id,"onload",window.wffnfunnelEnvironment):void 0!==window.wffnPublicVars&&Object.hasOwnProperty.call(window.wffnfunnelData,"hash")?(Cookies.set("wffn_si",window.wffnfunnelData.hash,{path:"/"}),this.HandleAnalytics(window.wffnfunnelData.hash,window.wffnfunnelData.current_step.id)||this.maybeHandleEcommEvents()):this.maybeHandleEcommEvents())},analyticsAlready:function(n,e){if(void 0!==Cookies.get("wffn_ay_"+n)&&""!==Cookies.get("wffn_ay_"+n)){n=JSON.parse(Cookies.get("wffn_ay_"+n));if(Array.isArray(n)&&0<=jQuery.inArray(parseInt(e),n))return!0}return!1},maybeHandleEcommEvents:function(){var n;"undefined"!=typeof wffnEvents&&0!==wffnEvents.length&&(n="undefined"!=typeof wffnfunnelEnvironment?wffnfunnelEnvironment:null,this.SendData("wffn_tracking_events",{events_data:wffnEvents,step_data:n},function(){}))},getAnalyticsData:function(n){return void 0!==Cookies.get("wffn_ay_"+n)&&""!==Cookies.get("wffn_ay_"+n)?JSON.parse(Cookies.get("wffn_ay_"+n)):[]},HandleAnalytics:function(n,e){var t=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"onload",f=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];if(void 0!==window.wffnPublicVars.is_preview&&1===window.wffnPublicVars.is_preview)return!1;if("onload"===i&&""===window.wffnfunnelData.support_track)return!1;if(void 0===n||void 0===e)return!1;if(!0===this.analyticsAlready(n,e))return!1;var a="undefined"!=typeof wffnEvents?wffnEvents:[],i=""!==f?f:void 0;return window.wffnEvents=[],o?this.maybeAddStepCookies(e,n,f):this.SendData("wffn_frontend_analytics",{events:a,current_step:i},function(){t.maybeAddStepCookies(e,n,f)},n),!0},maybeAddStepCookies:function(n,e,t){var i=this.getAnalyticsData(e);""!==t&&void 0!==i&&i.length<1||(i.push(parseInt(n)),Cookies.set("wffn_ay_"+e,JSON.stringify(i),{path:"/"}))},placeNextLink:function(){var n=document.querySelectorAll('a[href*="wffn-next-link=yes"]');0<n.length&&void 0!==window.wffnPublicVars&&""!==window.wffnPublicVars.next_link&&n.forEach(function(e){try{var n=new URL(e.href),t=new URLSearchParams(n.search);t.delete("wffn-next-link");var i=new URL(window.wffnPublicVars.next_link);t.toString()&&(i.search=t.toString()),e.setAttribute("href",i.toString()),e.classList.add("wffn-next-step-link")}catch(n){e.classList.add("wffn-next-step-link"),e.setAttribute("href",window.wffnPublicVars.next_link)}})},SendData:function(n,e,t){var i,f=3<arguments.length&&void 0!==arguments[3]&&arguments[3];wffnfunnelVars.is_ajax_mode?((i=new XMLHttpRequest).open("POST",window.wffnfunnelVars.ajaxUrl+"?action="+n+(!1!==f?"&wffn-si="+f:""),!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&200===this.status&&t(JSON.parse(this.response))},e="wffn_maybe_setup_funnel"===n?JSON.stringify(e):encodeURIComponent(JSON.stringify(e)),i.send("data="+e)):fetch(window.wffnfunnelVars.restUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:n,data:e})}).then(function(n){return n.json()}).then(t)}};window.wffnPublicVars=window.wffnfunnelData,wffnFunnel.setUpFunnel(),function(o){wffnFunnel.placeNextLink(),o(document).on("click",'a[href*="wffn-next-link=yes"]',function(n){if(n.preventDefault(),void 0===window.wffnPublicVars.is_preview||1!==window.wffnPublicVars.is_preview){if(""!==window.wffnPublicVars.next_link)try{var e=o(this).attr("href"),t=e.startsWith("http")?new URL(e):new URL(e,window.location.origin),i=new URLSearchParams(t.search);i.delete("wffn-next-link");var f=new URL(window.wffnPublicVars.next_link);f.search=i.toString(),window.location.href=f.toString()}catch(n){window.location.href=window.wffnPublicVars.next_link}}else n.stopPropagation()}),o(document.body).on("updated_checkout",function(){void 0!==window.wffnPublicVars.current_step.id&&void 0!==window.wffnPublicVars.hash&&(wffnFunnel.isSetUpCached()||wffnFunnel.HandleAnalytics(window.wffnPublicVars.hash,window.wffnPublicVars.current_step.id,"manual"))})}(jQuery);